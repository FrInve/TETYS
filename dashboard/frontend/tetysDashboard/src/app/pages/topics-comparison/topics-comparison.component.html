<div [class]="'bg-custom-gradient-' + bgColor + ' min-h-screen'">
    <app-navbar [rightSideIconUrl]="'assets/' + mainArea + 'Icon.svg'" [routingUrl]="mainArea"/>
    <div class="w-11/12 flex flex-col justify-between items-center gap-8 m-auto">

        <!-- FIRST SECTION -->
        <div class="w-full h-fit flex flex-row justify-start gap-4">
            <div
                *ngFor="let searchObj of searchHistory; index as i"
                [style.width.%]="elementWidth(i)"
                class="bg-primary-lightGrey rounded-lg p-1"
            >
                <input
                    [id]="'searchInput_' + i"
                    (focus)="handleInputFocus($event, i)"
                    (input)="handleSearchInput($event)"
                    [value]="searchObj.searchedTerm"
                    type="text" 
                    [ngClass]="{'z-[999]': isFocused(i)}"
                    class="relative h-14 w-full px-5 z-0
                    placeholder:text-lg
                    border-2 border-primary-grey rounded-lg
                    shadow-[1px_1px_10px_2px_rgba(0,0,0,0.15)]
                    focus:shadow focus:outline-none"
                />

                <div class="flex flex-row justify-around">
                    <topic-card
                        *ngFor="let selectedTopic of searchObj.selectedTopics; index as j"
                        class="min-h-64 w-full bg-white rounded-lg border-2 p-4 mt-4 mb-2 mx-2"
                        [style.borderColor]="getBorderColor(i, j)"
                        [selectable]="true"
                        [selectedIds]="selectedTopicsId"
                        (checkboxClick)="handleTopicSelect($event, i)"
                        [topicObj]="selectedTopic" 
                        [wordCloudId]="i + '_selected_' + j" 
                    />
                </div>
            </div>
            <div 
                *ngIf="!isDialogOpen && (selectedTopicsId.size < allowedTopicsNum)"
                (click)="addSearchInput()"
                class="md:w-1/5 sm:w-1/3 xs:w-1/2
                flex flex-row justify-start items-center gap-2
                h-14 px-5 mt-1
                cursor-pointer
                border-2 border-primary-skyBlue2 rounded-lg
                shadow-[1px_1px_10px_2px_rgba(0,0,0,0.15)]
                bg-primary-skyBlue3 hover:bg-primary-skyBlue2"
            >
                <div class="text-2xl pb-1">+</div>
                <div class="text-lg">Compare</div>
            </div>
        </div>

        <!-- SECOND SECTION -->
        <!-- <time-setting-card class="w-full" [(chartData)]="chartData"/> -->

        <!-- THIRD SECTION -->
        <div class="w-full bg-white shadow-[1px_1px_10px_2px_rgba(0,0,0,0.15)] rounded-lg mb-4">
            <div class="flex flex-row justify-between items-center text-base px-4">
                <span class="text-lg font-medium p-4">
                    Topics temporal trends
                    <hint-tooltip class="ml-3" tooltipTxt="The graph shows the change in the number of published material of selected topics over a customizable time period."/>
                </span> 
                <div>
                    <label class="text-base" for="countries" >Resolution</label>
                    <select 
                        (change)="timeResolutionChange($event)"
                        id="countries" 
                        class="h-8 px-4 ml-4
                        text-sm bg-white
                        cursor-pointer
                        border-2 border-primary-skyBlue2 rounded-lg"
                    >
                        <option class="text-sm" value="1">Daily</option>
                        <option class="text-sm" value="7">Weekly</option>
                        <option class="text-sm" value="30">Monthly</option>
                        <option class="text-sm" value="90">3 months</option>
                    </select>
                </div>
            </div>

            <div class="w-full h-[450px] p-4 pt-0">
                <line-chart chartId="test" [chartData]="chartData" [timeResolution]="timeResolution"/>
            </div>
        </div>
    </div> 
</div>


<popup-dialog 
    *ngIf="isPopupOpen"
    [closeOnOutsideClick]="canDialogClosed" 
    [position]="dialogPosition" 
    extraContentClass="w-11/12 bg-primary-lightGrey"
>
    <div class="grid max-h-[50vh] overflow-y-auto lg:grid-cols-5 md:grid-cols-4 sm:grid-cols-3 xs:grid-cols-2 gap-4">
        <topic-card
            *ngFor="let item of allTopics[focusedInputIndex]; index as i"
            class="w-full bg-white rounded-lg p-4"
            [disabledSelect]="selectedTopicsId.size === allowedTopicsNum"
            [selectable]="true"
            [selectedIds]="selectedTopicsId"
            (checkboxClick)="handleTopicSelect($event, focusedInputIndex)"
            [topicObj]="item" 
            [wordCloudId]="i+''" 
            [hasSimilarityScore]="true"
        />
    </div>

    <div class="flex flex-row justify-between items-center mt-4">
        <span class="text-base">Select up to {{ getRemainingTopicsNum }} topics to make a comparison</span>
        <button
            [disabled]="!canDialogClosed"
            (click)="hideTopicList()"
            class="h-9 px-5 pb-1
            disabled:opacity-60
            disabled:hover:bg-primary-skyBlue3
            text-base
            border-2 border-primary-skyBlue2 rounded-full
            shadow-[1px_1px_10px_2px_rgba(0,0,0,0.15)]
            bg-primary-skyBlue3 hover:bg-primary-skyBlue2">
            <span>compare</span>
        </button>
    </div>
</popup-dialog>

<app-loading *ngIf="isLoading"></app-loading>